# Signal Derived Retrieval
## Code for updating air mass factors (AMFs) in TEMPO NO2 retrieval
<br>
This repository contains the algorithm for the TEMPO signal-derived retrieval (SDR). The main script to run the algorithm is TEMPO/main/SDR-director.sh, which sets retrieval options, geographic scope, paths, and the time period to process. The main processing script is TEMPO/main/amf_update_one_scan.py, which constructs a dataset for the TEMPO scan ("scan_ds"), adds additional variables needed for the SDR, filters pixels by quality (in TEMPO/main/functions/prepare_for_update.py), and then carries out the redistribution of the prior and recalculation of the AMF (in TEMPO/main/functions/amf_recursive_update_sf.py). The TEMPO/main/functions folder contains most of the functions used in amf_update_one_scan.py. A parallel version of this process, amf_update_one_scan_par_script.py, writes these functions into the script for ipyparallel functionality.
<br>
<br>
In the current version of the algorithm, netCDF files are saved as "SDR-TEMPO..." with the updated VCD and AMF values taking the TEMPO names and appending "_updated_Standard" to the name. "updated" refers to the new value after the SDR, and "Standard" refers to the use of the standard scattering weight profile provided with the TEMPO V03 product. These updated variables have an additional dimension, "iteration", which counts over the number of times the prior was updated using the VCDs. Iteration 0 is the same as the normal product; for example, scan_ds.vertical_column_troposphere is the same as scan_ds.vertical_column_troposphere_updated_Standard.sel(iteration=0). For the signal-derived product, iteration 1 should be used. The current default settings run a 2nd iteration, mostly for troubleshooting purposes.
